- hosts: localhost
  remote_user: kubuntu
  vars:
    ZSH_CUSTOM: "~/.oh-my-zsh/custom"
  tasks:
############################# install all extensions #############################
  - name: install all vscodium extensions
    command: codium --install-extension {{ item }}
    loop:
      - astallinger.sourcetrail
      - coddx.coddx-alpha
      - CoenraadS.bracket-pair-colorizer-2
      - docsmsft.docs-yaml
      - donjayamanne.githistory
      - eamodio.gitlens
      - emmanuelbeziat.vscode-great-icons
      - geddski.macros
      - huizhou.githd
      - ipedrazas.kubernetes-snippets
      - jedmao.tabsanity
      - krvajalm.linter-gfortran
      - mhutchie.git-graph
      - mkloubert.vscode-kanban
      - ms-azuretools.vscode-docker
      - ms-kubernetes-tools.vscode-kubernetes-tools
      - ms-python.python
      - naumovs.color-highlight
      - njpwerner.autodocstring
      - redhat.vscode-yaml
      - s3gf4ult.monokai-vibrant
      - shaharkazaz.git-merger
      - shd101wyy.markdown-preview-enhanced
      - Tyriar.shell-launcher
      - vscoss.vscode-ansible
      - yzhang.markdown-all-in-one
############################# copy ipython config #############################
  - name: create ipython3 default profile
    command: ipython3 profile create default
  - name: create ipython3 custom profiles
    command: ipython3 profile create {{ item }}
    loop:
      - color
      - debug
  - name: copy profiles
    copy:
      src: IPython/profile_{{ item }}/ipython_config.py
      dest: ~/.ipython/profile_{{ item }}/ipython_config.py
    loop:
      - color
      - debug
############################# copy zsh config #############################
  - name: copy custom .zshrc
    copy:
      src: zshrc
      dest: ~/.zshrc
  - name: check if oh-my-zsh directory exists
    stat:
      path: ~/.oh-my-zsh
    register: oh_my_zsh
  - name: ensure that ohmyzsh is installed
    shell: sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
    when: oh_my_zsh.stat.exists == false
  - name: ensure that zsh-autosuggestions is installed
    git:
      repo: https://github.com/zsh-users/zsh-autosuggestions
      dest: "{{ ZSH_CUSTOM }}/plugins/zsh-autosuggestions"
  - name: ensure that zsh-syntax-highlighting is installed
    git:
      repo: https://github.com/zsh-users/zsh-syntax-highlighting
      dest: "{{ ZSH_CUSTOM }}/plugins/zsh-syntax-highlighting"
############################# merge actual file and vscodium #############################
  - name: check if settings file exists
    stat:
      path: ~/.config/VSCodium/User/settings.json
    register: vscodium_settings
  - name: merge config.json
    shell:
     cmd: "git merge-file -L user -L vscode-setup ~/.config/VSCodium/User/settings.json settings.json ~/.config/VSCodium/User/settings.json"
    when: vscodium_settings.stat.exists == true
  - name: copy config.json without merging
    copy:
      src: settings.json
      dest: ~/.config/VSCodium/User/settings.json
    when: vscodium_settings.stat.exists == false
  - name: check if keybindings file exists
    stat:
      path: ~/.config/VSCodium/User/keybindings.json
    register: vscodium_keybindings
  - name: merge keybindings.json
    shell:
     cmd: "git merge-file -L user -L vscode-setup $HOME/.config/VSCodium/User/keybindings.json settings.json $HOME/.config/VSCodium/User/keybindings.json"
    when: vscodium_keybindings.stat.exists == true
  - name: copy keybindings.json without merging
    copy:
      src: settings.json
      dest: ~/.config/VSCodium/User/settings.json
    when: vscodium_keybindings.stat.exists == false
